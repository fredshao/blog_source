---
title: 3D基础渲染管线
date: 2018-02-07 14:08:39
tags: 图形学
---

1. 视觉系统的特性：

   - 平行线汇集成一个点
   - 物体的大小会随着距离增加而减小，越远的物体看起来越小
   - 物体会有重叠（前后遮挡）
   - 光线和阴影是物体立体感和体积感最重要的因素

2. 计算机基本的颜色及运算

   - RGB（red, green, blue）

   - 加法(1,0,0) + (0,1,0) = (1,1,0) 黄光

   - 减法(1,1,0) - (0,1,0) = (1,0,0) 红光

   - 标量乘法 0.5 * (1,1,1) = (0.5,0.5,0.5) 灰光

   - 点积和叉积对于颜色运算来说没有任何意义

   - 分量乘法，例如一个物体的反射率为(0.75,0.25,0.5)，光线为(1,1,1)，则我们看到的颜色就是

     (1,1,1) * (0.75,0.25,0.5) = (0.75,0.25,0.5)

3. 顶点

   - 一个顶点可能包含很多数据，位置坐标，颜色值，法值线，UV 值等
   - 顶点缓冲区，存放顶点数据。索引缓冲区，存放顶点构成三角形的索引顺序，索引顺序不同，构成的三角形也不同(从外关上看起来可能并无不同)，进而影响光照的计算。索引顺序也确定了一个模型的正面和背面，进而影响渲染时的踢除（不渲染背面）。
   - Unity 中通过 Cull off 关闭背面踢除，这样就可以看到模型的背面
   - 索引可以减少内存
   - 索引是简单的整数、某些低端设备只支持65535个索引数据
   - 只渲染模型的某一部分，只要改变索引起始和终止即可
   - 合并绘制，即是将多的模型的缓冲区合并成一个缓冲区，并且将多个模型的索引缓冲区合并成一个索引缓冲区，即可以一次提交绘制
   - 一般是合并场景中那些不变的数据
   - 对一个模型平移、旋转、缩放，就是对这个模型的每一个顶点进行平移、旋转、缩放。

4. 像素着色

   - 裁剪掉在平截体外的几何体，由 GPU 自动完成
   - 光栅化阶段
     - 背面消隐（背面剔除）
     - 顶点插值
   - 在 Shader 中尽量全用常量值
   - 尽量在顶点Shader 中计算好需要的数据
   - 避免在像素Shader 里面做复杂的计算
   - 像素 Shader 的计算量远远大于顶点 Shader 的计算量
   - 输出阶段，某些像素被丢弃，未被丢弃的像素被写入到后台缓冲区